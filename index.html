<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>360 Viewer</title>
    <script src="aframe.min.js"></script>
    <script>
      const images = [
        "assets/Street View 360.jpg",
        "assets/2Street View 360.jpg",
        "assets/3Street View 360.jpg",
        "assets/IMG_20250908_145244_001_003_HDR_2025-09-16_09-46-54_screenshot.jpg"
      ];
      let currentIndex = 0;

      function changeImage() {
        currentIndex = (currentIndex + 1) % images.length;
        document.querySelector('#sky').setAttribute('src', images[currentIndex]);
      }

      function preloadImages() {
        images.forEach(src => {
          const img = new Image();
          img.src = src;
        });
      }

      function requestDeviceMotion() {
        if (typeof DeviceOrientationEvent !== "undefined" &&
            typeof DeviceOrientationEvent.requestPermission === "function") {
          DeviceOrientationEvent.requestPermission()
            .then(permissionState => {
              if (permissionState === "granted") console.log("Device motion enabled âœ…");
            })
            .catch(console.error);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        preloadImages();

        // Button clicks
        document.getElementById("switchBtn").addEventListener("click", () => {
          requestDeviceMotion();
          changeImage();
        });

        document.getElementById("vrBtn").addEventListener("click", () => {
          document.querySelector('a-scene').enterVR();
        });

        // VR clickPlane for switching images
        document.querySelector('#clickPlane').addEventListener('click', () => {
          changeImage();
        });

        // Show/hide UI based on VR mode
        const scene = document.querySelector('a-scene');
        scene.addEventListener('enter-vr', () => {
          document.getElementById("switchBtn").style.display = "none";
          document.getElementById("vrBtn").style.display = "none";
        });
        scene.addEventListener('exit-vr', () => {
          document.getElementById("switchBtn").style.display = "block";
          document.getElementById("vrBtn").style.display = "block";
        });
      });
    </script>
    <style>
      body, html { margin: 0; padding: 0; height: 100%; }

      /* Bottom Button Styles */
      .bottom-btn {
        position: fixed;
        bottom: 20px;
        padding: 10px 20px;
        font-size: 16px;
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        z-index: 9999;
      }

      #switchBtn {
        left: 20px;
      }

      #vrBtn {
        right: 20px;
      }

      .bottom-btn:hover {
        background: rgba(0, 0, 0, 0.8);
      }
    </style>
  </head>
  <body>
    <!-- Bottom Buttons -->
    <button id="switchBtn" class="bottom-btn">Next Image</button>
    <button id="vrBtn" class="bottom-btn">Enter VR</button>

    <a-scene vr-mode-ui="enabled: false">
      <a-sky id="sky" src="assets/Street View 360.jpg"></a-sky>

      <!-- Plane clickable in VR for scene change -->
      <a-plane id="clickPlane"
        position="0 0 -3"
        width="10" height="10"
        material="opacity: 0.0"
        visible="true">
      </a-plane>

      <!-- Camera & cursor -->
      <a-entity id="cameraRig">
        <a-camera look-controls="magicWindowTrackingEnabled: true; pointerLockEnabled: true;">
          <a-cursor 
            fuse="true" 
            fuseTimeout="1000"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
            material="color: white; shader: flat">
          </a-cursor>
        </a-camera>
      </a-entity>
    </a-scene>
  </body>
</html>
